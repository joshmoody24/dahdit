<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morse Code Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .controls {
            margin: 20px 0;
        }
        input, button {
            margin: 5px;
            padding: 8px;
        }
        input[type="text"] {
            width: 300px;
        }
        input[type="range"] {
            width: 200px;
        }
        .param-group {
            margin: 10px 0;
        }
        label {
            display: inline-block;
            width: 120px;
        }
        .loading {
            color: #666;
        }
    </style>
</head>
<body>
    <h1>Morse Code Generator</h1>
    <p>Generate and play Morse code audio in your browser!</p>
    <p><strong>Prosigns:</strong> Use <code>[brackets]</code> for <a href="https://en.wikipedia.org/wiki/Prosigns_for_Morse_code" target="_blank">prosigns</a> like <code>[SOS]</code>, <code>[AR]</code>, or <code>[SK]</code>. These run letters together without normal spacing.</p>

    <div class="controls">
        <div class="param-group">
            <label for="text">Text:</label>
            <input type="text" id="text" value="HELLO WORLD [SOS]" placeholder="Enter text to convert (use [brackets] for prosigns)">
        </div>

        <div class="param-group">
            <label for="wpm">WPM:</label>
            <input type="range" id="wpm" min="5" max="50" value="20">
            <span id="wpm-value">20</span>
        </div>

        <div class="param-group">
            <label for="frequency">Frequency:</label>
            <input type="range" id="frequency" min="200" max="1000" value="440">
            <span id="frequency-value">440</span> Hz
        </div>

        <div class="param-group">
            <label for="volume">Volume:</label>
            <input type="range" id="volume" min="0" max="100" value="50">
            <span id="volume-value">0.5</span>
        </div>

        <div class="param-group">
            <button id="generate">Generate & Play</button>
            <button id="stop" disabled>Stop</button>
        </div>
    </div>

    <div id="status">Ready! Enter text and click Generate & Play.</div>

    <script type="module">
        import { generateMorseAudio, playMorseAudio, ready } from './bindings/javascript/morse.js';

        let currentSource = null;

        // Update display values for sliders
        function updateSliderDisplays() {
            document.getElementById('wpm-value').textContent = document.getElementById('wpm').value;
            document.getElementById('frequency-value').textContent = document.getElementById('frequency').value;
            document.getElementById('volume-value').textContent = (document.getElementById('volume').value / 100).toFixed(1);
        }

        // Add event listeners for sliders
        document.getElementById('wpm').addEventListener('input', updateSliderDisplays);
        document.getElementById('frequency').addEventListener('input', updateSliderDisplays);
        document.getElementById('volume').addEventListener('input', updateSliderDisplays);

        // Generate and play button
        document.getElementById('generate').addEventListener('click', async () => {
            const params = {
                text: document.getElementById('text').value,
                wpm: parseInt(document.getElementById('wpm').value),
                frequency: parseInt(document.getElementById('frequency').value),
                volume: parseFloat(document.getElementById('volume').value) / 100
            };

            document.getElementById('status').textContent = 'Generating audio...';

            try {
                const audioResult = await generateMorseAudio(params);
                if (audioResult) {
                    document.getElementById('status').textContent =
                        `Generated ${audioResult.duration.toFixed(2)}s of audio. Playing...`;

                    currentSource = playMorseAudio(audioResult);
                    document.getElementById('stop').disabled = false;

                    // Re-enable stop button when audio finishes
                    if (currentSource) {
                        currentSource.onended = () => {
                            document.getElementById('stop').disabled = true;
                            currentSource = null;
                        };
                    }
                } else {
                    document.getElementById('status').textContent = 'Failed to generate audio.';
                }
            } catch (error) {
                document.getElementById('status').textContent = 'Error: ' + error.message;
            }
        });

        // Stop button
        document.getElementById('stop').addEventListener('click', () => {
            if (currentSource) {
                currentSource.stop();
                currentSource = null;
                document.getElementById('stop').disabled = true;
                document.getElementById('status').textContent = 'Stopped.';
            }
        });

        // Initialize slider displays
        updateSliderDisplays();
    </script>
</body>
</html>